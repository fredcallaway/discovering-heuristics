// Generated by CoffeeScript 1.11.1

/*
jspsych-template.coffee
Fred Callaway

Template for jspsych plugins
 */

(function() {
  var DEBUG,
    slice = [].slice;

  DEBUG = function() {
    var args;
    args = 1 <= arguments.length ? slice.call(arguments, 0) : [];
    return null;
  };

  jsPsych.plugins['template'] = (function() {
    var plugin;
    plugin = {};
    plugin.trial = function(display_element, trial) {
      var after_response, display, end_trial, start_trial;
      display = display_element;
      trial = jsPsych.pluginAPI.evaluateFunctionParameters(trial);
      DEBUG('trial', trial);
      start_trial = function() {
        DEBUG('start', trial);
        if (trial.prompt) {
          display_element.append(trial.prompt);
        }
        trial.keyboard_listener = jsPsych.pluginAPI.getKeyboardResponse({
          callback_function: after_response,
          valid_responses: ['P', 'Q'],
          rt_method: 'date',
          persist: false,
          allow_held_key: false
        });
      };
      after_response = function(info) {
        DEBUG('after', trial);
        trial.data = {
          response: String.fromCharCode(info.key),
          rt: info.rt
        };
        display.append($('<div>', {
          id: 'template-feedback',
          html: 'nice job!'
        }));
        DEBUG('trial.data ', trial.data);
        setTimeout(end_trial, 2000);
      };
      end_trial = function() {
        DEBUG('end', trial);
        display.html('');
        jsPsych.finishTrial(trial.data);
      };
      return start_trial();
    };
    return plugin;
  })();

}).call(this);
